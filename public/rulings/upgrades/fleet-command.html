<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>KARM Rulings Book</title>
    <link rel="preload" href="/rulings/fonts/optima.woff?v=rulings-v1" as="font" type="font/woff" crossorigin />
    <link rel="preload" href="/rulings/fonts/optima-italic.woff?v=rulings-v1" as="font" type="font/woff" crossorigin />
    <link rel="preload" href="/rulings/fonts/optima-bold.woff?v=rulings-v1" as="font" type="font/woff" crossorigin />
    <link rel="preload" href="/rulings/fonts/RevengerLiteBB.woff?v=rulings-v1" as="font" type="font/woff" crossorigin />
    <link rel="preload" href="/rulings/fonts/TeutonFett.woff?v=rulings-v1" as="font" type="font/woff" crossorigin />
    <link rel="preload" href="/rulings/fonts/icons.woff?v=rulings-v1" as="font" type="font/woff" crossorigin />
    <style>
      :root { --page-background: url('/rulings/assets/rulebook-background.webp?v=rulings-v1'); }
      
@font-face {
  font-family: 'OptimaCustom';
  src: url('/rulings/fonts/optima.woff?v=rulings-v1') format('woff');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: 'OptimaCustom';
  src: url('/rulings/fonts/optima-italic.woff?v=rulings-v1') format('woff');
  font-weight: 400;
  font-style: italic;
  font-display: swap;
}

@font-face {
  font-family: 'OptimaCustom';
  src: url('/rulings/fonts/optima-bold.woff?v=rulings-v1') format('woff');
  font-weight: 700;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: 'AeroMaticsDisplay';
  src: url('/rulings/fonts/fighter-keyword.woff?v=rulings-v1') format('woff');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: 'AeroMaticsDisplay';
  src: url('/rulings/fonts/fighter-keyword.woff?v=rulings-v1') format('woff');
  font-weight: 700;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: 'TeutonFett';
  src: url('/rulings/fonts/TeutonFett.woff?v=rulings-v1') format('woff');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: 'RevengerLite';
  src: url('/rulings/fonts/RevengerLiteBB.woff?v=rulings-v1') format('woff');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: 'Icons';
  src: url('/rulings/fonts/icons.woff?v=rulings-v1') format('woff');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: 'ArmadaIcons';
  src: url('/rulings/fonts/icons.woff?v=rulings-v1') format('woff');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}
      :root {
  --page-width: 2194px;
  --page-height: 2820px;
  --page-scale: 1;
  --page-padding-y: 120px;
  --page-padding-x: 129px;
  --page-gap: 24px;
  --ink: #221e1d;
  --accent: #24408f;
}

* {
  box-sizing: border-box;
}

html,
body {
  margin: 0;
  padding: 0;
  color: var(--ink);
  font-family: "OptimaCustom", Optima, "Segoe UI", Arial, sans-serif;
  background: #444;
}

.toc-fab {
  position: fixed;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  z-index: 30;
  border: 0;
  border-radius: 999px;
  width: 56px;
  height: 56px;
  padding: 0;
  background: #24408f;
  color: #fff;
  font-family: "OptimaCustom", Optima, "Segoe UI", Arial, sans-serif;
  cursor: pointer;
  box-shadow: 0 10px 24px rgba(0, 0, 0, 0.28);
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.hamburger {
  display: inline-flex;
  flex-direction: column;
  justify-content: center;
  gap: 5px;
}

.hamburger > span {
  display: block;
  width: 24px;
  height: 3px;
  border-radius: 999px;
  background: #fff;
}

.toc-drawer {
  position: fixed;
  top: 0;
  right: 0;
  width: min(380px, 88vw);
  height: 100vh;
  z-index: 29;
  background: rgba(245, 242, 235, 0.98);
  border-left: 1px solid rgba(36, 64, 143, 0.25);
  box-shadow: -16px 0 40px rgba(0, 0, 0, 0.2);
  padding: 18px 16px 24px;
  overflow: auto;
  transform: translateX(104%);
  transition: transform 180ms ease;
}

body.toc-open .toc-drawer {
  transform: translateX(0);
}

.toc-title {
  font-family: "TeutonFett", "AeroMaticsDisplay", sans-serif;
  font-size: 36px;
  margin: 0 0 10px;
}

.toc-link {
  display: block;
  color: #1f1f1f;
  text-decoration: none;
  padding: 8px 4px;
  border-bottom: 1px solid rgba(36, 64, 143, 0.15);
  font-size: 20px;
  line-height: 1.2;
}

.toc-link:hover {
  color: #24408f;
}

.toc-link.toc-sub {
  padding-left: 16px;
  font-size: 17px;
}

.toc-section-label {
  font-family: "TeutonFett", "AeroMaticsDisplay", sans-serif;
  font-size: 20px;
  color: var(--accent);
  padding: 12px 4px 4px;
  letter-spacing: 0.02em;
}

/* ── Search FAB ── */

.search-fab {
  position: fixed;
  right: 10px;
  top: calc(50% + 70px);
  transform: translateY(-50%);
  z-index: 30;
  border: 0;
  border-radius: 999px;
  width: 56px;
  height: 56px;
  padding: 0;
  background: #24408f;
  color: #fff;
  font-family: "OptimaCustom", Optima, "Segoe UI", Arial, sans-serif;
  cursor: pointer;
  box-shadow: 0 10px 24px rgba(0, 0, 0, 0.28);
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.search-fab svg {
  display: block;
}

/* ── Search drawer ── */

.search-drawer {
  position: fixed;
  top: 0;
  right: 0;
  width: min(380px, 88vw);
  height: 100vh;
  z-index: 29;
  background: rgba(245, 242, 235, 0.98);
  border-left: 1px solid rgba(36, 64, 143, 0.25);
  box-shadow: -16px 0 40px rgba(0, 0, 0, 0.2);
  padding: 18px 16px 24px;
  overflow: auto;
  transform: translateX(104%);
  transition: transform 180ms ease;
}

body.search-open .search-drawer {
  transform: translateX(0);
}

.search-drawer-title {
  font-family: "TeutonFett", "AeroMaticsDisplay", sans-serif;
  font-size: 36px;
  margin: 0 0 16px;
}

.search-input {
  width: 100%;
  font-family: "OptimaCustom", Optima, "Segoe UI", Arial, sans-serif;
  font-size: 18px;
  padding: 10px 12px;
  border: none;
  border-bottom: 2px solid rgba(36, 64, 143, 0.35);
  background: transparent;
  outline: none;
  color: #221e1d;
  margin-bottom: 18px;
}

.search-input:focus {
  border-bottom-color: #24408f;
}

.search-input::placeholder {
  color: #999;
}

/* ── Faction filter buttons ── */

.faction-filters {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 12px;
}

.faction-btn {
  width: 44px;
  height: 44px;
  border-radius: 999px;
  border: 2px solid #ccc;
  background: #e8e5de;
  color: #999;
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: background 120ms, border-color 120ms, color 120ms;
  padding: 0;
  font-family: "OptimaCustom", Optima, "Segoe UI", Arial, sans-serif;
}

.faction-btn .icon-font {
  font-size: 22px;
  line-height: 1;
}

.faction-btn[data-faction="all"] {
  font-size: 15px;
  letter-spacing: 0.02em;
}

.faction-btn.active {
  border-color: #24408f;
  background: #24408f;
  color: #fff;
}

.faction-btn.faction-rebel.active {
  background: #c0392b;
  border-color: #c0392b;
}

.faction-btn.faction-empire.active {
  background: #2e7d32;
  border-color: #2e7d32;
}

.faction-btn.faction-republic.active {
  background: #b8860b;
  border-color: #b8860b;
}

.faction-btn.faction-separatist.active {
  background: #1565c0;
  border-color: #1565c0;
}

.faction-btn.faction-neutral.active {
  background: #666;
  border-color: #666;
}

.search-result-count {
  font-size: 14px;
  color: #666;
  padding: 4px 0;
}

/* ── Filtered-out cards and dividers ── */

.karm-card.filtered-out,
.card-divider.filtered-out {
  display: none;
}

.no-results {
  text-align: center;
  padding: 48px 24px;
  font-size: 18px;
  color: #666;
  font-family: "OptimaCustom", Optima, "Segoe UI", Arial, sans-serif;
  display: none;
}

.no-results.visible {
  display: block;
}

@media (max-width: 760px) {
  .toc-fab {
    top: auto;
    bottom: 14px;
    right: 14px;
    transform: none;
  }

  .search-fab {
    top: auto;
    bottom: 80px;
    right: 14px;
    transform: none;
  }
}

@page {
  size: 2194px 2820px;
  margin: 0;
}

.karm-book {
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 8px;
}

.karm-page-shell {
  display: flex;
  justify-content: center;
  width: 100%;
  height: calc(var(--page-height) * var(--page-scale));
  overflow: hidden;
}

.karm-page {
  width: var(--page-width);
  height: var(--page-height);
  margin: 0;
  display: flex;
  flex-direction: column;
  position: relative;
  isolation: isolate;
  overflow: hidden;
  background-color: #f5f2eb;
  background-image: var(--page-background);
  background-size: cover;
  background-repeat: no-repeat;
  padding: var(--page-padding-y) var(--page-padding-x);
  gap: var(--page-gap);
  transform: scale(var(--page-scale));
  transform-origin: top center;
}

.karm-static-page {
  width: 100%;
  height: 100%;
}

.page-body {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 56px;
}

.page-number {
  position: absolute;
  right: 88px;
  bottom: 76px;
  color: var(--accent);
  font-size: 54px;
  line-height: 1;
  text-transform: uppercase;
  letter-spacing: 0.03em;
  font-family: "RevengerLite", Impact, sans-serif;
}

.karm-card {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 14px;
  break-inside: avoid;
  page-break-inside: avoid;
}

.card-top {
  display: flex;
  gap: 25px;
  min-height: 500px;
}

.card-image-wrap {
  width: 350px;
  min-width: 350px;
}

.card-image {
  width: 350px;
  height: 498px;
  border-radius: 14px;
  object-fit: cover;
  background: #d9d9d9;
  border: 1px solid rgba(0, 0, 0, 0.15);
}

.card-image.fallback {
  display: flex;
  align-items: center;
  justify-content: center;
  color: #666;
  font-style: italic;
}

.card-main {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.card-title {
  font-family: "TeutonFett", "Teuton Fett", "AeroMaticsDisplay", "Arial Narrow", sans-serif;
  font-size: 52px;
  line-height: 1.04;
  letter-spacing: -0.045em;
  font-variant: small-caps;
  text-transform: none;
  margin: 0;
}

.card-meta {
  font-size: 29px;
  line-height: 1.2;
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 12px;
}

.card-faction-icon {
  width: 34px;
  height: 34px;
  object-fit: contain;
  vertical-align: middle;
}

.card-body,
.card-keywords,
.card-rulings {
  font-weight: 400;
  font-size: 29px;
  line-height: 35px;
  letter-spacing: 0.006em;
}

.card-keywords {
  font-size: 27px;
}

.card-keyword-label {
  font-family: "AeroMaticsDisplay", "RevengerLite", "Trajan Pro", Georgia, serif;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.04em;
  color: var(--accent);
  margin-right: 8px;
}

.squadron-keywords .squadron-keyword-values,
.squadron-keywords .squadron-keyword-token {
  font-family: "AeroMaticsDisplay", "RevengerLite", "Trajan Pro", Georgia, serif;
  font-weight: 700;
}

.squadron-keywords .squadron-keyword-token {
  letter-spacing: 0.01em;
}

.card-bottom {
  font-weight: 400;
  font-size: 29px;
  line-height: 35px;
  letter-spacing: 0.006em;
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.top-summary {
  display: flex;
  flex-direction: column;
  gap: 18px;
  margin-top: 6px;
}

.top-summary-block {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.top-summary-label {
  font-family: "OptimaCustom", Optima, "Segoe UI", Arial, sans-serif;
  font-size: 46px;
  font-weight: 700;
  line-height: 1.05;
  text-transform: capitalize;
}

.top-summary-text {
  font-size: 29px;
  line-height: 1.22;
  font-weight: 400;
  font-family: "OptimaCustom", Optima, "Segoe UI", Arial, sans-serif;
}

.top-summary-text p {
  margin: 0;
}

.ruling-section {
  break-inside: avoid;
  page-break-inside: avoid;
}

.ruling-heading {
  margin: 0 0 2px;
  font-size: 46px;
  line-height: 1.1;
  font-family: "OptimaCustom", Optima, "Segoe UI", Arial, sans-serif;
  font-weight: 700;
  color: #202020;
}

.ruling-content {
  margin: 0;
}

.ruling-content p {
  margin: 0 0 6px;
  font-weight: 400;
}

.ruling-content ul {
  margin: 0;
  padding-left: 32px;
}

.ruling-content li,
.ruling-content li p,
.card-text-content,
.card-text-content p {
  font-weight: 400;
}

.footnote-ref {
  display: inline-block;
  font-size: 0.72em;
  line-height: 0;
  vertical-align: baseline;
  transform: translateY(-0.38em);
  margin-left: 0.12em;
}

.card-text-content p {
  margin: 0 0 8px;
}

.icon-font {
  font-family: "Icons", "ArmadaIcons", "RevengerLite", sans-serif;
  font-style: normal;
  font-weight: 400;
  font-variant: normal;
  text-transform: none;
  line-height: 1;
  speak: never;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  display: inline-block;
}

.ruling-footnotes {
  margin-top: 14px;
  border-top: 1px solid rgba(36, 64, 143, 0.3);
  padding-top: 8px;
  font-size: 18px;
  line-height: 1.35;
  font-weight: 400;
}

.karm-header-card {
  min-height: 760px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.section-header-title {
  font-size: 116px;
  line-height: 1;
  letter-spacing: 0.02em;
  text-transform: uppercase;
  color: var(--accent);
  font-family: "RevengerLite", "Trajan Pro", Georgia, serif;
}

.ruling-content blockquote {
  margin: 8px 0;
  padding: 6px 0 6px 18px;
  border-left: 5px solid rgba(36, 64, 143, 0.4);
  font-style: italic;
}

.ruling-content code {
  font-family: "SFMono-Regular", Consolas, monospace;
  background: rgba(0, 0, 0, 0.05);
  padding: 0 4px;
  border-radius: 4px;
}

.keyword-name {
  font-family: "AeroMaticsDisplay", "RevengerLite", sans-serif;
  font-weight: 400;
  font-style: normal;
}

/* ── Continuous responsive web layout ── */

body.karm-web {
  background: #f5f2eb;
  background-image: var(--page-background);
  background-size: cover;
  background-position: center top -60px;
  background-attachment: fixed;
  background-repeat: no-repeat;
  overflow-x: hidden;
}

body.karm-web .karm-book {
  max-width: 960px;
  width: 100%;
  margin: 0 auto;
  padding: 32px 24px;
  gap: 0;
  overflow-wrap: break-word;
  word-wrap: break-word;
}

body.karm-web .karm-page-shell,
body.karm-web .karm-page {
  display: none;
}

body.karm-web .karm-continuous {
  display: flex;
  flex-direction: column;
  gap: 0;
}

body.karm-web .page-number {
  display: none;
}

/* ── Card layout ── */

body.karm-web .karm-card {
  max-width: 100%;
}

body.karm-web .card-top {
  min-height: auto;
  gap: 20px;
}

body.karm-web .card-main {
  min-width: 0;
  flex: 1;
}

body.karm-web .card-image-wrap {
  width: 220px;
  min-width: 220px;
  flex-shrink: 0;
}

body.karm-web .card-image {
  width: 220px;
  height: 312px;
  max-width: 100%;
  border-radius: 10px;
}

/* ── Typography ── */

body.karm-web .card-title {
  font-size: 28px;
  letter-spacing: -0.03em;
}

body.karm-web .card-meta {
  font-size: 16px;
  gap: 8px;
}

body.karm-web .card-body,
body.karm-web .card-keywords,
body.karm-web .card-rulings,
body.karm-web .card-bottom {
  font-size: 16px;
  line-height: 1.5;
}

body.karm-web .card-keywords {
  font-size: 15px;
}

body.karm-web .top-summary-label {
  font-size: 24px;
}

body.karm-web .top-summary-text {
  font-size: 16px;
  line-height: 1.45;
}

body.karm-web .ruling-heading {
  font-size: 24px;
}

body.karm-web .ruling-content ul {
  padding-left: 24px;
}

body.karm-web .ruling-footnotes {
  font-size: 13px;
}

body.karm-web .section-header-title {
  font-size: 48px;
}

body.karm-web .karm-header-card {
  min-height: 120px;
  padding: 24px 0;
}

body.karm-web .card-divider {
  border: none;
  border-top: 1px solid rgba(36, 64, 143, 0.2);
  margin: 28px 0;
}

/* ── Tablet ── */

@media (max-width: 768px) {
  body.karm-web .karm-book {
    padding: 24px 16px;
  }

  body.karm-web .card-top {
    flex-direction: column;
    align-items: flex-start;
    gap: 16px;
  }

  body.karm-web .card-image-wrap {
    width: auto;
    min-width: unset;
    flex-shrink: unset;
  }

  body.karm-web .card-image {
    width: 180px;
    height: 256px;
  }

  body.karm-web .card-title {
    font-size: 24px;
  }

  body.karm-web .section-header-title {
    font-size: 36px;
  }

  body.karm-web .karm-header-card {
    min-height: 80px;
    padding: 16px 0;
  }
}

/* ── Mobile ── */

@media (max-width: 480px) {
  body.karm-web .karm-book {
    padding: 16px 12px;
  }

  body.karm-web .card-top {
    align-items: center;
  }

  body.karm-web .card-image {
    width: 160px;
    height: 228px;
  }

  body.karm-web .card-title {
    font-size: 22px;
    text-align: center;
  }

  body.karm-web .card-body,
  body.karm-web .card-keywords,
  body.karm-web .card-rulings,
  body.karm-web .card-bottom {
    font-size: 15px;
    line-height: 1.45;
  }

  body.karm-web .top-summary-label {
    font-size: 20px;
  }

  body.karm-web .ruling-heading {
    font-size: 20px;
  }

  body.karm-web .section-header-title {
    font-size: 28px;
  }

  body.karm-web .card-divider {
    margin: 20px 0;
  }
}

@media print {
  .toc-fab,
  .toc-drawer,
  .search-fab,
  .search-drawer,
  .no-results {
    display: none !important;
  }

  :root {
    --page-scale: 1;
  }

  html,
  body {
    background: transparent;
  }

  .karm-book {
    gap: 0;
    padding: 0;
  }

  .karm-page-shell {
    height: auto;
    overflow: visible;
  }

  .karm-page {
    margin: 0;
    transform: none;
    page-break-after: always;
    break-after: page;
  }

  .karm-page:last-child {
    page-break-after: auto;
    break-after: auto;
  }
}

    </style>
  </head>
  <body class="karm-web">
    
<button type="button" class="toc-fab" aria-label="Open rulings menu" onclick="document.body.classList.toggle('toc-open'); document.body.classList.remove('search-open');">
  <span class="hamburger" aria-hidden="true"><span></span><span></span><span></span></span>
</button>
<aside class="toc-drawer" aria-label="Rulings navigation">
  <div class="toc-title">Rulings</div>
  <a href="/rulings/objectives.html" class="toc-link">Objectives</a>
<a href="/rulings/campaign.html" class="toc-link">Campaign Objectives</a>
<a href="/rulings/damage-cards.html" class="toc-link">Damage Cards</a>
<a href="/rulings/upgrades.html" class="toc-link">Upgrades</a>
<a href="/rulings/squadrons.html" class="toc-link">Ace Squadrons</a>
<div class="toc-section-label">Upgrade Types</div>
<a href="/rulings/upgrades/commander.html" class="toc-link toc-sub">Commander</a>
<a href="/rulings/upgrades/officer.html" class="toc-link toc-sub">Officer</a>
<a href="/rulings/upgrades/weapons-team-offensive-retro.html" class="toc-link toc-sub">Boarding Teams</a>
<a href="/rulings/upgrades/weapons-team.html" class="toc-link toc-sub">Weapons Team</a>
<a href="/rulings/upgrades/offensive-retro.html" class="toc-link toc-sub">Offensive Retrofit</a>
<a href="/rulings/upgrades/defensive-retro.html" class="toc-link toc-sub">Defensive Retrofit</a>
<a href="/rulings/upgrades/turbolaser.html" class="toc-link toc-sub">Turbolaser</a>
<a href="/rulings/upgrades/ion-cannon.html" class="toc-link toc-sub">Ion Cannon</a>
<a href="/rulings/upgrades/ordnance.html" class="toc-link toc-sub">Ordnance</a>
<a href="/rulings/upgrades/fleet-support.html" class="toc-link toc-sub">Fleet Support</a>
<a href="/rulings/upgrades/support-team.html" class="toc-link toc-sub">Support Team</a>
<a href="/rulings/upgrades/experimental-retro.html" class="toc-link toc-sub">Experimental Retrofit</a>
<a href="/rulings/upgrades/fleet-command.html" class="toc-link toc-sub">Fleet Command</a>
<a href="/rulings/upgrades/title.html" class="toc-link toc-sub">Title</a>
<a href="/rulings/upgrades/super-weapon.html" class="toc-link toc-sub">Superweapon</a>
<div class="toc-section-label">Nexus</div>
<a href="/rulings/nexus-upgrades.html" class="toc-link toc-sub">Nexus Upgrades</a>
<a href="/rulings/nexus-squadrons.html" class="toc-link toc-sub">Nexus Squadrons</a>
</aside>
<button type="button" class="search-fab" aria-label="Search cards" onclick="document.body.classList.toggle('search-open'); document.body.classList.remove('toc-open');">
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
</button>
<aside class="search-drawer" aria-label="Search and filter">
  <div class="search-drawer-title">Search &amp; Filter</div>
  <input type="text" class="search-input" id="karm-search-input" placeholder="Search cards..." autocomplete="off" />
  <div class="faction-filters" id="karm-faction-filters">
    <button type="button" class="faction-btn active" data-faction="all" aria-label="All factions" title="All">All</button>
    <button type="button" class="faction-btn faction-rebel active" data-faction="rebel" aria-label="Rebel Alliance" title="Rebel"><span class="icon-font">[</span></button>
    <button type="button" class="faction-btn faction-empire active" data-faction="empire" aria-label="Galactic Empire" title="Empire"><span class="icon-font">\</span></button>
    <button type="button" class="faction-btn faction-republic active" data-faction="republic" aria-label="Republic" title="Republic"><span class="icon-font">|</span></button>
    <button type="button" class="faction-btn faction-separatist active" data-faction="separatist" aria-label="Separatist" title="Separatist"><span class="icon-font">}</span></button>
    <button type="button" class="faction-btn faction-neutral active" data-faction="neutral" aria-label="Neutral" title="Neutral">&#9733;</button>
  </div>
  <div class="search-result-count" id="karm-result-count"></div>
</aside>
<div class="no-results" id="karm-no-results">No matching cards found.</div>
    <div class="karm-book">
      
      <div class="karm-continuous">
<article class="karm-card karm-header-card" id="fleet-command-1" data-category="header">
  <div class="section-header-title">Fleet Command <span class="icon-font">M</span></div>
</article>

<article class="karm-card" id="all-fighters-follow-me-2" data-name="all fighters, follow me!" data-factions="" data-category="upgrades" data-type="fleet-command">
  <div class="card-top">
    <div class="card-image-wrap"><img class="card-image" src="https://images.swarmada.wiki/images/all-fighters-follow-me.webp" alt="All Fighters, Follow Me!" /></div>
    <div class="card-main">
      <h2 class="card-title">All Fighters, Follow Me! <span class="icon-font"> M</span></h2>
      <div class="top-summary">
<div class="top-summary-block">
  <div class="top-summary-label">Card Text</div>
  <div class="top-summary-text"><p>At the start of the Ship Phase, you may discard this card or spend a <span class="icon-font">8</span> token. If you do, until the end of the round, the speed of each squadron that a friendly ship activates is increased by 1, to a maximum of 5, until the end of that squadron&#39;s activation.</p></div>
</div>
<div class="top-summary-block">
  <div class="top-summary-label">Timing</div>
  <div class="top-summary-text">This Upgrade Card resolves at the start of the Ship Phase. You may discard this card or spend a squadron command token to resolve this card&#39;s effect.</div>
</div></div>
    </div>
  </div>
  <div class="card-bottom card-rulings">
<div class="ruling-section">
  <h3 class="ruling-heading">Clarifications</h3>
  <div class="ruling-content"><ul><li>If the ship with this Upgrade Card equipped is destroyed after resolving this effect, squadrons activated by friendly ships are still affected until the end of the round. <span class="footnote-ref">[1]</span></li><li>A squadron&#39;s speed may not be increased to greater than 5. <span class="footnote-ref">[1]</span></li><li>This Upgrade Card does not affect Squall or Fighter Coordination Team, as those cards move squadrons a &#39;distance&#39;, not a speed. <span class="footnote-ref">[1]</span></li><li>Card abilities that change a squadron&#39;s speed such as Independence, Vector, or Corruptor will combine with this card&#39;s increase in a squadron&#39;s speed. <span class="footnote-ref">[1]</span></li><li>Card abilities that allow a squadron to move at a &#39;printed&#39; speed, such as Admiral Chiraneau, will allow that squadron to move by an additional speed of 1 if this Upgrade Card&#39;s effect is active. <span class="footnote-ref">[1]</span></li><li>Triggering this Upgrade Card does not resolve a squadron command, and thus does not trigger abilities such as Flight Controllers. <span class="footnote-ref">[1]</span></li></ul></div>
</div>

<div class="ruling-section">
  <h3 class="ruling-heading">Squadron Interactions</h3>
  <div class="ruling-content"><ul><li>Squadrons activated during the Squadron Phase of a round do not gain the benefit of this Upgrade Card. <span class="footnote-ref">[1]</span></li><li>Ketsu Onyo reduces the speed of squadrons at distance 1 of her, to a minimum of 1. After that reduction, any speed enhancing card effects such as this Upgrade Card take place. <span class="footnote-ref">[1]</span></li></ul></div>
</div></div>
  <div class="ruling-footnotes"><div>[1] ARC | 2025-07-11 | ARM 1.03</div></div>
</article>
<hr class="card-divider" />

<article class="karm-card" id="entrapment-formation-3" data-name="entrapment formation!" data-factions="" data-category="upgrades" data-type="fleet-command">
  <div class="card-top">
    <div class="card-image-wrap"><img class="card-image" src="https://images.swarmada.wiki/images/entrapment-formation.webp" alt="Entrapment Formation!" /></div>
    <div class="card-main">
      <h2 class="card-title">Entrapment Formation! <span class="icon-font"> M</span></h2>
      <div class="top-summary">
<div class="top-summary-block">
  <div class="top-summary-label">Card Text</div>
  <div class="top-summary-text"><p>At the start of the Ship Phase, you may discard this card or spend a <span class="icon-font">7</span> token. If you do, until the end of the round, each friendly ship may change its speed by 1 during its Determine Course step.</p></div>
</div>
<div class="top-summary-block">
  <div class="top-summary-label">Timing</div>
  <div class="top-summary-text">This Upgrade Card resolves at the start of the Ship Phase. You may discard this card or spend a Navigation command token to resolve this card&#39;s effect.</div>
</div></div>
    </div>
  </div>
  <div class="card-bottom card-rulings">
<div class="ruling-section">
  <h3 class="ruling-heading">Clarifications</h3>
  <div class="ruling-content"><ul><li>If the ship with this Upgrade Card equipped is destroyed after resolving this effect, friendly ships are still affected until the end of the round. <span class="footnote-ref">[1]</span></li></ul></div>
</div>

<div class="ruling-section">
  <h3 class="ruling-heading">Upgrade Interactions</h3>
  <div class="ruling-content"><ul><li>This Upgrade Card does not resolve a navigation command and thus does not trigger abilities such as Engine Techs or Quantum Storm. <span class="footnote-ref">[1]</span></li><li>A ship may have multiple &#39;Determine Course&#39; steps during its activation (due to card abilities like Engine Techs). A ship may utilize the benefit of this Upgrade Card and adjust the speed on its speed dial during each &#39;Determine Course&#39; Step of its activation. <span class="footnote-ref">[1]</span></li><li>Some card effects, like Engine Techs, grant the ability to perform a maneuver set to a particular speed. This Upgrade Card cannot change that specified maneuver speed. <span class="footnote-ref">[1]</span></li></ul></div>
</div></div>
  <div class="ruling-footnotes"><div>[1] ARC | 2025-07-11 | ARM 1.03</div></div>
</article>
<hr class="card-divider" />

<article class="karm-card" id="hot-landing-4" data-name="hot landing" data-factions="republic,separatist" data-category="upgrades" data-type="fleet-command">
  <div class="card-top">
    <div class="card-image-wrap"><img class="card-image" src="https://images.swarmada.wiki/images/hot-landing.webp" alt="Hot Landing" /></div>
    <div class="card-main">
      <h2 class="card-title">Hot Landing <span class="icon-font"> M</span></h2>
      <div class="top-summary">
<div class="top-summary-block">
  <div class="top-summary-label">Card Text</div>
  <div class="top-summary-text"><p>At the start of the Squadron Phase, friendly squadrons with adept gain grit until the end of the phase. When a friendly squadron with adept is destroyed, you may choose 1 enemy ship at distance 1-2 of that squadron. If you do, that ship gains 1 raid token of your choice.</p></div>
</div>
<div class="top-summary-block">
  <div class="top-summary-label">Timing</div>
  <div class="top-summary-text">The effect of this Upgrade Card triggers during the squadron phase or when a friendly squadron has been destroyed by an attack or card effect.<br/>If a ship with this Upgrade Card equipped is destroyed before the start of the Squadron Phase, then friendly squadrons with Adept do not gain Grit in that Squadron Phase.</div>
</div></div>
    </div>
  </div>
  <div class="card-bottom card-rulings">
<div class="ruling-section">
  <h3 class="ruling-heading">Upgrade Interactions</h3>
  <div class="ruling-content"><ul><li>If a player chooses to resolve Reserve Hangar Deck when a squadron is destroyed, the player may resolve this Upgrade Card&#39;s effect first to give out a raid token before resolving Reserve Hangar Deck. <span class="footnote-ref">[1]</span></li></ul></div>
</div></div>
  <div class="ruling-footnotes"><div>[1] ARC | 2025-07-11 | ARM 1.03</div></div>
</article>
<hr class="card-divider" />

<article class="karm-card" id="intensify-firepower-5" data-name="intensify firepower!" data-factions="" data-category="upgrades" data-type="fleet-command">
  <div class="card-top">
    <div class="card-image-wrap"><img class="card-image" src="https://images.swarmada.wiki/images/intensify-firepower.webp" alt="Intensify Firepower!" /></div>
    <div class="card-main">
      <h2 class="card-title">Intensify Firepower! <span class="icon-font"> M</span></h2>
      <div class="top-summary">
<div class="top-summary-block">
  <div class="top-summary-label">Card Text</div>
  <div class="top-summary-text"><p>At the start of the Ship Phase, you may discard this card or spend a <span class="icon-font">9</span> token. If you do, until the end of the round, while each friendly ship is attacking a ship, it may change 1 die to a face with 1 <span class="icon-font">S</span> icon and no other icons.</p></div>
</div>
<div class="top-summary-block">
  <div class="top-summary-label">Timing</div>
  <div class="top-summary-text">This Upgrade Card resolves at the start of the Ship Phase. You may discard this card or spend a Concentrate Fire command token to resolve this Upgrade Card&#39;s effect.</div>
</div></div>
    </div>
  </div>
  <div class="card-bottom card-rulings">
<div class="ruling-section">
  <h3 class="ruling-heading">Clarifications</h3>
  <div class="ruling-content"><ul><li>If the ship with this Upgrade Card equipped is destroyed after resolving this effect, friendly ships are still affected until the end of the round. <span class="footnote-ref">[1]</span></li><li>This Upgrade Card works with Salvo attacks. <span class="footnote-ref">[1]</span></li><li>This Upgrade Card does not work with Counter attacks as it is only valid while attacking a ship. <span class="footnote-ref">[1]</span></li></ul></div>
</div>

<div class="ruling-section">
  <h3 class="ruling-heading">Upgrade Interactions</h3>
  <div class="ruling-content"><ul><li>This Upgrade Card does not resolve a Concentrate Fire command and thus does not trigger abilities such as Director Krennic or Mon Karren. <span class="footnote-ref">[1]</span></li></ul></div>
</div></div>
  <div class="ruling-footnotes"><div>[1] ARC | 2025-07-11 | ARM 1.03</div></div>
</article>
<hr class="card-divider" />

<article class="karm-card" id="jedi-hostage-6" data-name="jedi hostage" data-factions="separatist" data-category="upgrades" data-type="fleet-command">
  <div class="card-top">
    <div class="card-image-wrap"><img class="card-image" src="https://images.swarmada.wiki/images/jedi-hostage.webp" alt="Jedi Hostage" /></div>
    <div class="card-main">
      <h2 class="card-title">Jedi Hostage <span class="icon-font"> M</span></h2>
      <div class="top-summary">
<div class="top-summary-block">
  <div class="top-summary-label">Card Text</div>
  <div class="top-summary-text"><p>When an enemy ship declares you as the target of a non-<span class="icon-font">6</span> attack, if this card is readied, the attacker gains a raid token of its choice, if able. When an enemy ship at close range reveals a command, it may discard a <span class="icon-font">8</span> dial to exhaust this card. While defending, if this card is exhausted, you cannot spend more than 1 defense token.</p></div>
</div>
<div class="top-summary-block">
  <div class="top-summary-label">Timing</div>
  <div class="top-summary-text">The effect of this Upgrade Card triggers during an opponent&#39;s attack step 1: &#39;Declare Target&#39;.</div>
</div></div>
    </div>
  </div>
  <div class="card-bottom card-rulings">
<div class="ruling-section">
  <h3 class="ruling-heading">Clarifications</h3>
  <div class="ruling-content"><ul><li>A squadron dial discarded to exhaust this Upgrade Card may not be used for another purpose, for example clearing Raid tokens or activating a Boarding Team. <span class="footnote-ref">[1]</span></li><li>The attacker may not choose to receive a Raid token already assigned to the attacking ship. <span class="footnote-ref">[1]</span></li><li>A pre-existing squadron Raid token does not prevent the discard of a squadron dial, as the Raid token only prevents resolution of a squadron command. <span class="footnote-ref">[1]</span></li></ul></div>
</div></div>
  <div class="ruling-footnotes"><div>[1] ARC | 2025-07-11 | ARM 1.03</div></div>
</article>
<hr class="card-divider" />

<article class="karm-card" id="mercy-mission-7" data-name="mercy mission" data-factions="republic" data-category="upgrades" data-type="fleet-command">
  <div class="card-top">
    <div class="card-image-wrap"><img class="card-image" src="https://images.swarmada.wiki/images/mercy-mission.webp" alt="Mercy Mission" /></div>
    <div class="card-main">
      <h2 class="card-title">Mercy Mission <span class="icon-font"> M</span></h2>
      <div class="top-summary">
<div class="top-summary-block">
  <div class="top-summary-label">Card Text</div>
  <div class="top-summary-text"><p>Before deploying fleets, un-equip this card and choose 1 friendly small ship that is not your flagship. Equip this card to the chosen ship (even if it does not have a :fleet command: icon in its upgrade bar). At the end of the game, if you are within the enemy deployment zone, increase your score by 40 points; if you were destroyed, increase your opponent&#39;s score by 15 points.</p></div>
</div>
<div class="top-summary-block">
  <div class="top-summary-label">Timing</div>
  <div class="top-summary-text">This Upgrade Card&#39;s first effect occurs before deploying fleets. This Upgrade Card&#39;s second effect occurs at the end of the game, before tallying scores.</div>
</div></div>
    </div>
  </div>
  <div class="card-bottom card-rulings">
<div class="ruling-section">
  <h3 class="ruling-heading">Clarifications</h3>
  <div class="ruling-content"><ul><li>If the fleet has no non-flagship small ship, then this Upgrade Card remains equipped on the original ship regardless of that ship&#39;s size. <span class="footnote-ref">[1]</span></li></ul></div>
</div>

<div class="ruling-section">
  <h3 class="ruling-heading">Objective Interactions</h3>
  <div class="ruling-content"><ul><li>If the only small ship in a player&#39;s fleet is set aside with Hyperspace Assault, this Upgrade Card remains equipped to the current ship. <span class="footnote-ref">[1]</span></li><li>If the ship this Upgrade Card is equipped to is set aside by Hyperspace Assault, this Upgrade Card remains equipped to that ship. <span class="footnote-ref">[1]</span></li></ul></div>
</div></div>
  <div class="ruling-footnotes"><div>[1] ARC | 2025-07-11 | ARM 1.03</div></div>
</article>
<hr class="card-divider" />

<article class="karm-card" id="shields-to-maximum-8" data-name="shields to maximum!" data-factions="" data-category="upgrades" data-type="fleet-command">
  <div class="card-top">
    <div class="card-image-wrap"><img class="card-image" src="https://images.swarmada.wiki/images/shields-to-maximum.webp" alt="Shields to Maximum!" /></div>
    <div class="card-main">
      <h2 class="card-title">Shields to Maximum! <span class="icon-font"> M</span></h2>
      <div class="top-summary">
<div class="top-summary-block">
  <div class="top-summary-label">Card Text</div>
  <div class="top-summary-text"><p>At the start of the Ship Phase, you may discard this card or spend a <span class="icon-font">0</span> token. If you do, until the end of the round, before a friendly ship reveals a command, it may recover 1 shield.</p></div>
</div>
<div class="top-summary-block">
  <div class="top-summary-label">Timing</div>
  <div class="top-summary-text">This Upgrade Card resolves at the start of the Ship Phase. You may discard this Upgrade card or spend an Engineering command token to resolve this card&#39;s effect.</div>
</div></div>
    </div>
  </div>
  <div class="card-bottom card-rulings">
<div class="ruling-section">
  <h3 class="ruling-heading">Clarifications</h3>
  <div class="ruling-content"><ul><li>If the ship with this Upgrade Card equipped is destroyed after resolving this effect, friendly ships are still affected until the end of the round. <span class="footnote-ref">[1]</span></li><li>If a ship has the face up damage card Crew Panic, you can resolve this Upgrade Card before Crew Panic. <span class="footnote-ref">[1]</span></li><li>If a ship has the face up damage card Capacitor Failure, you cannot recover a shield in a hull zone with &#39;0&#39; shields remaining. <span class="footnote-ref">[1]</span></li></ul></div>
</div>

<div class="ruling-section">
  <h3 class="ruling-heading">Upgrade Interactions</h3>
  <div class="ruling-content"><ul><li>This Upgrade Card does not resolve the Repair command, and thus does not trigger abilities such as Engineering Team or Projection Experts. <span class="footnote-ref">[1]</span></li></ul></div>
</div></div>
  <div class="ruling-footnotes"><div>[1] ARC | 2025-07-11 | ARM 1.03</div></div>
</article>
<hr class="card-divider" />

<article class="karm-card" id="take-evasive-action-9" data-name="take evasive action!" data-factions="" data-category="upgrades" data-type="fleet-command">
  <div class="card-top">
    <div class="card-image-wrap"><img class="card-image" src="https://images.swarmada.wiki/images/take-evasive-action.webp" alt="Take Evasive Action!" /></div>
    <div class="card-main">
      <h2 class="card-title">Take Evasive Action! <span class="icon-font"> M</span></h2>
      <div class="top-summary">
<div class="top-summary-block">
  <div class="top-summary-label">Card Text</div>
  <div class="top-summary-text"><p>At the start of the Ship Phase, you may discard this card or spend a <span class="icon-font">7</span> token. If you do, until the end of the round, each friendly ship may increase the last yaw value of its current speed by 1 during its Determine Course step.</p></div>
</div>
<div class="top-summary-block">
  <div class="top-summary-label">Timing</div>
  <div class="top-summary-text">This Upgrade Card resolves at the start of the Ship Phase. You may discard this card or spend an Engineering command token to resolve this Upgrade Card&#39;s effect.</div>
</div></div>
    </div>
  </div>
  <div class="card-bottom card-rulings">
<div class="ruling-section">
  <h3 class="ruling-heading">Clarifications</h3>
  <div class="ruling-content"><ul><li>If the ship with this Upgrade Card equipped is destroyed after resolving this effect, friendly ships are still affected until the end of the round. <span class="footnote-ref">[1]</span></li><li>This Upgrade Card can be used to add yaw back on the last joint if it was reduced by Thrust Control Malfunction. <span class="footnote-ref">[1]</span></li></ul></div>
</div>

<div class="ruling-section">
  <h3 class="ruling-heading">Upgrade Interactions</h3>
  <div class="ruling-content"><ul><li>A ship performing an &#39;extra&#39; speed 1 maneuver from an ability such as Engine Techs will not gain the benefit of This Upgrade Card if that ship&#39;s speed dial is set to a speed higher than 1. <span class="footnote-ref">[1]</span></li><li>This Upgrade Card does not resolve a Navigation command, and thus does not trigger abilities such as Engine Techs or Quantum Storm. <span class="footnote-ref">[1]</span></li><li>If a ship&#39;s speed is temporarily slowed by an effect such as the G-8 Experimental Projector, you will not be able to use this Upgrade Card as the maneuver speed no longer matches the value shown on the speed dial. <span class="footnote-ref">[1]</span></li></ul></div>
</div>

<div class="ruling-section">
  <h3 class="ruling-heading">Objective Interactions</h3>
  <div class="ruling-content"><ul><li>This Upgrade Card cannot change the yaw value for the speed 1 maneuver for the 1st player in Rift Ambush as the maneuver &#39;must&#39; be done with a yaw value of &#39;-&#39;. The 2nd player may add yaw to the forced executed maneuver (see above). <span class="footnote-ref">[1]</span></li></ul></div>
</div></div>
  <div class="ruling-footnotes"><div>[1] ARC | 2025-07-11 | ARM 1.03</div></div>
</article>
<hr class="card-divider" />

<article class="karm-card karm-header-card" id="nexus-upgrades-10" data-category="header">
  <div class="section-header-title">Nexus Upgrades </div>
</article>

<article class="karm-card karm-header-card" id="fleet-command-11" data-category="header">
  <div class="section-header-title">Fleet Command <span class="icon-font">M</span></div>
</article>

<article class="karm-card" id="nova-flare-nr-12" data-name="nova flare {nr}" data-factions="neutral" data-category="nexus-upgrades" data-type="fleet-command">
  <div class="card-top">
    <div class="card-image-wrap"><img class="card-image" src="https://images.swarmada.wiki/images/nova-flare-new-republic-nexus.webp" alt="Nova Flare {NR}" /></div>
    <div class="card-main">
      <h2 class="card-title">Nova Flare {NR} <span class="icon-font"> M</span></h2>
      
    </div>
  </div>
  <div class="card-bottom card-rulings">
<div class="ruling-section">
  <h3 class="ruling-heading">Card Text</h3>
  <div class="ruling-content"><div class="card-text-content"><p>At the start of each Ship Phase, you may discard this card or spend a <span class="icon-font">9</span> token. If you do, until the end of the round, while a friendly ship or squadron with <span class="keyword-name">Bomber</span> is attacking a ship, if the defending hull zone has 1 or more shields, it may reroll 1 die.</p></div></div>
</div></div>
  
</article>
<hr class="card-divider" />

<article class="karm-card" id="peace-accords-nr-13" data-name="peace accords {nr}" data-factions="neutral" data-category="nexus-upgrades" data-type="fleet-command">
  <div class="card-top">
    <div class="card-image-wrap"><img class="card-image" src="https://images.swarmada.wiki/images/peace-accords-new-republic-nexus.webp" alt="Peace Accords {NR}" /></div>
    <div class="card-main">
      <h2 class="card-title">Peace Accords {NR} <span class="icon-font"> M</span></h2>
      
    </div>
  </div>
  <div class="card-bottom card-rulings">
<div class="ruling-section">
  <h3 class="ruling-heading">Card Text</h3>
  <div class="ruling-content"><div class="card-text-content"><p>Before deploying fleets, un-equip this card and choose 1 friendly small ship with the senate tag that is not your flagship. Equip this card to the chosen ship (even if it does not have a :fleet command: icon in its upgrade bar). At the end of the game, if you are at distance 1-2 of the enemy flagship, increase your score by 40 points.</p></div></div>
</div></div>
  
</article>
<hr class="card-divider" />

<article class="karm-card" id="the-big-score-scum-14" data-name="the big score {scum}" data-factions="scum" data-category="nexus-upgrades" data-type="fleet-command">
  <div class="card-top">
    <div class="card-image-wrap"><img class="card-image" src="https://images.swarmada.wiki/images/the-big-score-scum-nexus.webp" alt="The Big Score {Scum}" /></div>
    <div class="card-main">
      <h2 class="card-title">The Big Score {Scum} <span class="icon-font"> M</span></h2>
      
    </div>
  </div>
  <div class="card-bottom card-rulings">
<div class="ruling-section">
  <h3 class="ruling-heading">Card Text</h3>
  <div class="ruling-content"><div class="card-text-content"><p>While defending, after rolling dice, if there are two or more dice in the attack pool, the attacker must choose and cancel 1 die with a <span class="icon-font">S</span> or <span class="icon-font">T</span> icon on its face, if able.</p><p>When an enemy ship at close range reveals a command, it may discard a <span class="icon-font">8</span> dial or token to discard this card and deal you two face-down damage cards.</p></div></div>
</div></div>
  
</article></div>
      
    </div>
    
    <script>
(function () {
  var searchInput = document.getElementById('karm-search-input');
  var filtersContainer = document.getElementById('karm-faction-filters');
  var noResults = document.getElementById('karm-no-results');
  var resultCount = document.getElementById('karm-result-count');
  if (!searchInput || !filtersContainer) return;

  var factionBtns = filtersContainer.querySelectorAll('.faction-btn[data-faction]');
  var allBtn = filtersContainer.querySelector('.faction-btn[data-faction="all"]');
  var factionKeys = ['rebel', 'empire', 'republic', 'separatist', 'neutral'];
  var activeFactions = new Set(factionKeys);

  function syncAllBtn() {
    if (allBtn) {
      if (activeFactions.size === factionKeys.length) {
        allBtn.classList.add('active');
      } else {
        allBtn.classList.remove('active');
      }
    }
  }

  function applyFilters() {
    var query = (searchInput.value || '').toLowerCase().trim();
    var cards = document.querySelectorAll('.karm-card');
    var dividers = document.querySelectorAll('.card-divider');
    var visibleCount = 0;
    var lastHeaderIdx = -1;
    var cardsAfterHeader = 0;
    var headerElements = [];
    var allFactions = activeFactions.size === factionKeys.length;

    for (var i = 0; i < cards.length; i++) {
      var card = cards[i];
      var isHeader = card.getAttribute('data-category') === 'header';

      if (isHeader) {
        if (lastHeaderIdx >= 0) {
          cards[lastHeaderIdx].classList.toggle('filtered-out', cardsAfterHeader === 0);
        }
        lastHeaderIdx = i;
        cardsAfterHeader = 0;
        continue;
      }

      var name = card.getAttribute('data-name') || '';
      var factions = (card.getAttribute('data-factions') || '').split(',').filter(Boolean);

      var matchesSearch = !query || name.indexOf(query) !== -1;
      var matchesFaction = allFactions || factions.length === 0 || factions.some(function (f) { return activeFactions.has(f.toLowerCase()); });
      var visible = matchesSearch && matchesFaction;

      card.classList.toggle('filtered-out', !visible);
      if (visible) {
        visibleCount++;
        cardsAfterHeader++;
      }
    }

    if (lastHeaderIdx >= 0) {
      cards[lastHeaderIdx].classList.toggle('filtered-out', cardsAfterHeader === 0);
    }

    for (var d = 0; d < dividers.length; d++) {
      var hr = dividers[d];
      var prev = hr.previousElementSibling;
      var next = hr.nextElementSibling;
      var hideDivider = (!prev || prev.classList.contains('filtered-out')) ||
                        (!next || next.classList.contains('filtered-out'));
      hr.classList.toggle('filtered-out', hideDivider);
    }

    if (noResults) {
      noResults.classList.toggle('visible', visibleCount === 0 && (query || !allFactions));
    }
    if (resultCount) {
      if (query || !allFactions) {
        resultCount.textContent = visibleCount + ' card' + (visibleCount !== 1 ? 's' : '') + ' found';
        resultCount.style.display = '';
      } else {
        resultCount.textContent = '';
        resultCount.style.display = 'none';
      }
    }
  }

  searchInput.addEventListener('input', applyFilters);

  filtersContainer.addEventListener('click', function (e) {
    var btn = e.target.closest('.faction-btn');
    if (!btn) return;
    var faction = btn.getAttribute('data-faction');

    if (faction === 'all') {
      if (activeFactions.size === factionKeys.length) {
        activeFactions.clear();
        factionBtns.forEach(function (b) { b.classList.remove('active'); });
      } else {
        factionKeys.forEach(function (f) { activeFactions.add(f); });
        factionBtns.forEach(function (b) { b.classList.add('active'); });
      }
    } else {
      if (activeFactions.has(faction)) {
        activeFactions.delete(faction);
        btn.classList.remove('active');
      } else {
        activeFactions.add(faction);
        btn.classList.add('active');
      }
    }
    syncAllBtn();
    applyFilters();
  });

  searchInput.addEventListener('keydown', function (e) {
    if (e.key === 'Escape') {
      searchInput.value = '';
      applyFilters();
    }
  });
})();
</script>
    <!-- Generated cards: 14 -->
  </body>
</html>